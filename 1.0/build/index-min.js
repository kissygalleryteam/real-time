/*!build time : 2013-11-25 8:01:59 PM*/
KISSY.add("gallery/real-time/1.0/index",function(a){function b(c){var d=this;return d.config=a.merge(i,c),d instanceof b?(b.superclass.constructor.call(d,d.config),d._init(),void 0):new b(d.config)}var c=(a.Event,a.DOM,a.io),d=a.Date,e=1e3,f=6e4,g=36e5,h=a.now(),i={serviceTime:null,url:"",isJsonp:!0,isAutoUpdate:!0,ajaxUpMinutes:1,localTimeUpdate:1};return b.events=["localTimeUpdateMod","ajaxTimeUpdateMod","simulationServerTimeMod"],a.extend(b,a.Base),a.augment(b,{_init:function(){var a=this;a._argumentsInit(),a.get("isAutoUpdate")?a.startAutoUpdateTime():a.stopAutoUpdateTime()},_argumentsInit:function(){var a=this;a._renderMainTime()},getDateStr:function(a){return d.format(a,"yyyy-mm-dd HH:MM:ss")},getTimeYMDstr:function(a){var b=this,a=a?a:b.mainTime;return d.format(a,"yyyy-mm-dd")},getCurrTimeHMSstr:function(a){var b=this,a=a?a:b.mainTime;return b.getAllHMSstr(a)},_renderMainTime:function(){var b=this,c=a.now()-h,d=b.get("serviceTime");return a.isNumber(d)||(d=b.getDateParse(d)),d||b.get("url")?(d&&(b.mainTime=d+c,b.serverLocalCompara()),void 0):(b.mainTime=a.now(),b.hasServiceTime=!1,b.fire("localTimeUpdateMod"),void 0)},_eventRender:function(){},getCurrTime:function(){{var a=this;a.hasServiceTime?null:a.mainTime}return a.mainTime},getServerLocalDiff:function(){var a=this,b=a.differenceTime?a.differenceTime:null;return b},serverLocalCompara:function(){var b=this,c=a.now();if(b.mainTime)return b.differenceTime=Math.abs(c-b.mainTime),c>b.mainTime?b.localTimeMax=!0:c<b.mainTime&&(b.localTimeMax=!1),b.localTimeMax},_correctionTime:function(){var b=this,c=a.now();return b.differenceTime=b.differenceTime?b.differenceTime:0,b.mainTime=b.localTimeMax?c-b.differenceTime:c+b.differenceTime,b.mainTime},isInTimeRange:function(a,b,c){return b>a&&c>b?!0:!1},getServerTime:function(){var b=this,d=a.now(),e=b.get("isJsonp")?"jsonp":"json",f="jsonp"===e?"get":"post";c({cache:!1,url:b.get("url"),dataType:e,type:f,data:null,success:function(c){var e=a.now()-d;if(a.isObject(c)&&(b.mainTime=c.serviceTime),a.isString(c)){try{c=a.json.parse(c)}catch(f){a.log("json\u6570\u636e\u8f6c\u6362\u51fa\u9519\uff1a"+f)}b.mainTime=c.serviceTime}b.mainTime=b.mainTime+e,b.serverLocalCompara(),b.fire("ajaxTimeUpdateMod")}})},sortHMtimeArray:function(b){function c(a,b){var a=d.getMillisecond(a),b=d.getMillisecond(b);return a-b}var d=this;if(a.isArray(b))return b.sort(c)},addZeroFn:function(a){var a=parseInt(a,10);return a||0===a?10>a?"0"+a:a:""},autoComplement:function(a,b,c,d){var e,f=this,d=d?d:!0,g="00",h=":",a=a?f.addZeroFn(a):g,b=b?f.addZeroFn(b):g,c=c?f.addZeroFn(c):g;return e=d?[a,b]:[a,b,c],e.join(h)},getAllHMSstr:function(b){var c=null;if(!b)return"";if(a.isString(b))return b;try{c=new Date(b)}catch(e){return""}return c&&c.getFullYear?d.format(b,"HH:MM:ss"):""},allStrHMtimeRenderFn:function(b){var c=this,d=[],b=a.isArray(b)?b:[b];return a.each(b,function(b){var e=b?b:"",f=c.getSelectHMS(e,"H"),g=c.getSelectHMS(e,"M"),h=c.formatHMSstr(e);return f>23||g>59?(a.log("\u65f6\u95f4\u70b9:"+e+'" \u914d\u7f6e\u65e0\u6548\uff01'),void 0):(d.push(h),void 0)}),d},formatHMSstr:function(a,b){var c=this,a=a?a:"",d=c.getSelectHMS(a,"H"),e=c.getSelectHMS(a,"M"),f=c.getSelectHMS(a,"S");return c.autoComplement(d,e,f,b)},getSelectHMS:function(a,b){var c,d=a?a.split(":"):[];switch(b){case"H":c=parseInt(d[0],10);break;case"M":c=parseInt(d[1],10);break;case"S":c=parseInt(d[2],10)}return c},getHMstr:function(b){var c=this;if(a.isNumber(b)){var d=b/g,e=parseInt(d,10),h=(d-e)*g/f,i=Math.round(h),j=parseInt(h,10),k=Math.abs(i-h)<=1e-10?i:j;return c.autoComplement(e,k)}},getMillisecond:function(b){var c=this;if(a.isNumber(b))return b;var d=c.getSelectHMS(b,"H"),h=c.getSelectHMS(b,"M"),i=c.getSelectHMS(b,"S");if(h>59||i>59||d>23)return a.log("\u914d\u7f6e\u65f6\u95f4\u9519\u8bef\uff01"),void 0;var j=d?d*g:0,k=h?h*f:0,l=i?i*e:0;return j+k+l},offsetDateSeconds:function(b,c,d){var e,f=this,g=a.isString(b)?f.getDateParse(b):a.isNumber(b)?b:(new Date).getTime(),h=c?c:0;switch(d){case"+":e=g+h;break;case"-":e=g-h;break;default:e=g}return e},getDateParse:function(a){if(a){var b=d.parse(a.replace(/\-/g,"/")),c=b?b.getTime():0;return c}},startAutoUpdateTime:function(){var a=this;a._ajaxUpdateTime(),a._renderNewTime()},_renderNewTime:function(){function a(){b._correctionTime()}var b=this,c=b.get("localTimeUpdate")<1?1:b.get("localTimeUpdate"),d=c*e;b.autoCorrectionIntvl||(b.autoCorrectionIntvl=setInterval(a,d))},_ajaxUpdateTime:function(){var a=this,b=a.get("ajaxUpMinutes")<1?1:a.get("ajaxUpMinutes"),c=b*f;a.get("url")&&!a.ajaxTimeUpdate&&(a.ajaxTimeUpdate=setInterval(function(){a.getServerTime()},c))},stopAutoUpdateTime:function(){var a=this;a.ajaxTimeUpdate&&clearInterval(a.ajaxTimeUpdate),a.autoCorrectionIntvl&&clearInterval(a.autoCorrectionIntvl)}}),b},{requires:["calendar"]});